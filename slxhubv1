local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

local Settings = {
    Enabled = false,
    FOV = 80,
    TeamCheck = false,
    KillCheck = false,
    WallCheck = false,
    TargetPart = "Head"
}

local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = true
FOVCircle.Filled = false
FOVCircle.Thickness = 1
FOVCircle.Transparency = 1
FOVCircle.Color = Color3.fromRGB(255, 255, 255)
FOVCircle.Radius = Settings.FOV

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AimbotGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = gethui and gethui() or game:GetService("CoreGui")

local ToggleButton = Instance.new("ImageButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0, 50, 0, 50)
ToggleButton.Position = UDim2.new(0, 10, 0, 10)
ToggleButton.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
ToggleButton.Image = "rbxassetid://132533655213092"
ToggleButton.ImageColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.ScaleType = Enum.ScaleType.Fit
ToggleButton.ZIndex = 10
ToggleButton.Parent = ScreenGui

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(1, 0)
ToggleCorner.Parent = ToggleButton

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 180, 0, 260)
MainFrame.Position = UDim2.new(0, 70, 0, 10)
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Visible = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "Title"
TitleLabel.Size = UDim2.new(1, 0, 0, 30)
TitleLabel.Position = UDim2.new(0, 0, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "S l x Aimbot"
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextScaled = true
TitleLabel.Parent = MainFrame

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 223)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextScaled = true
CloseButton.Parent = MainFrame

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(1, 0)
CloseCorner.Parent = CloseButton

local AimbotToggle = Instance.new("TextButton")
AimbotToggle.Name = "AimbotToggle"
AimbotToggle.Size = UDim2.new(1, -20, 0, 30)
AimbotToggle.Position = UDim2.new(0, 10, 0, 35)
AimbotToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
AimbotToggle.Text = "Aimbot: ðŸ—£OFF"
AimbotToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
AimbotToggle.Font = Enum.Font.Gotham
AimbotToggle.TextScaled = true
AimbotToggle.Parent = MainFrame

local AimbotCorner = Instance.new("UICorner")
AimbotCorner.CornerRadius = UDim.new(0, 6)
AimbotCorner.Parent = AimbotToggle

local FOVLabel = Instance.new("TextLabel")
FOVLabel.Name = "FOVLabel"
FOVLabel.Size = UDim2.new(1, -20, 0, 30)
FOVLabel.Position = UDim2.new(0, 10, 0, 70)
FOVLabel.BackgroundTransparency = 1
FOVLabel.Text = "FOV: 80"
FOVLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FOVLabel.Font = Enum.Font.Gotham
FOVLabel.TextScaled = true
FOVLabel.Parent = MainFrame

local FOVSlider = Instance.new("TextButton")
FOVSlider.Name = "FOVSlider"
FOVSlider.Size = UDim2.new(1, -20, 0, 15)
FOVSlider.Position = UDim2.new(0, 10, 0, 105)
FOVSlider.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
FOVSlider.Text = ""
FOVSlider.AutoButtonColor = false
FOVSlider.Parent = MainFrame

local SliderFill = Instance.new("Frame")
SliderFill.Name = "SliderFill"
SliderFill.Size = UDim2.new(0.4, 0, 1, 0)
SliderFill.Position = UDim2.new(0, 0, 0, 0)
SliderFill.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
SliderFill.Parent = FOVSlider

local SliderFillCorner = Instance.new("UICorner")
SliderFillCorner.CornerRadius = UDim.new(1, 0)
SliderFillCorner.Parent = SliderFill

local SliderCorner = Instance.new("UICorner")
SliderCorner.CornerRadius = UDim.new(1, 0)
SliderCorner.Parent = FOVSlider

local TeamCheckBtn = Instance.new("TextButton")
TeamCheckBtn.Name = "TeamCheck"
TeamCheckBtn.Size = UDim2.new(1, -20, 0, 25)
TeamCheckBtn.Position = UDim2.new(0, 10, 0, 130)
TeamCheckBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TeamCheckBtn.Text = "Team Check: OFF"
TeamCheckBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
TeamCheckBtn.Font = Enum.Font.Gotham
TeamCheckBtn.TextScaled = true
TeamCheckBtn.Parent = MainFrame

local TeamCorner = Instance.new("UICorner")
TeamCorner.CornerRadius = UDim.new(0, 6)
TeamCorner.Parent = TeamCheckBtn

local KillCheckBtn = Instance.new("TextButton")
KillCheckBtn.Name = "KillCheck"
KillCheckBtn.Size = UDim2.new(1, -20, 0, 25)
KillCheckBtn.Position = UDim2.new(0, 10, 0, 160)
KillCheckBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
KillCheckBtn.Text = "Kill Check: OFF"
KillCheckBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
KillCheckBtn.Font = Enum.Font.Gotham
KillCheckBtn.TextScaled = true
KillCheckBtn.Parent = MainFrame

local KillCorner = Instance.new("UICorner")
KillCorner.CornerRadius = UDim.new(0, 6)
KillCorner.Parent = KillCheckBtn

local WallCheckBtn = Instance.new("TextButton")
WallCheckBtn.Name = "WallCheck"
WallCheckBtn.Size = UDim2.new(1, -20, 0, 25)
WallCheckBtn.Position = UDim2.new(0, 10, 0, 190)
WallCheckBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
WallCheckBtn.Text = "Wall Check: OFF"
WallCheckBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
WallCheckBtn.Font = Enum.Font.Gotham
WallCheckBtn.TextScaled = true
WallCheckBtn.Parent = MainFrame

local WallCorner = Instance.new("UICorner")
WallCorner.CornerRadius = UDim.new(0, 6)
WallCorner.Parent = WallCheckBtn

local TargetContainer = Instance.new("Frame")
TargetContainer.Name = "TargetContainer"
TargetContainer.Size = UDim2.new(1, -20, 0, 36)
TargetContainer.Position = UDim2.new(0, 10, 0, 220)
TargetContainer.BackgroundTransparency = 1
TargetContainer.ClipsDescendants = false
TargetContainer.Parent = MainFrame

local TargetLabel = Instance.new("TextLabel")
TargetLabel.Name = "TargetLabel"
TargetLabel.Size = UDim2.new(1, 0, 0, 16)
TargetLabel.Position = UDim2.new(0, 0, 0, 0)
TargetLabel.BackgroundTransparency = 1
TargetLabel.Text = "Target Part"
TargetLabel.TextSize = 13
TargetLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TargetLabel.Font = Enum.Font.Gotham
TargetLabel.Parent = TargetContainer

local TargetDropdown = Instance.new("TextButton")
TargetDropdown.Name = "TargetDropdown"
TargetDropdown.Size = UDim2.new(1, 0, 0, 20)
TargetDropdown.Position = UDim2.new(0, 0, 0, 16)
TargetDropdown.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TargetDropdown.BorderSizePixel = 0
TargetDropdown.Text = "Head"
TargetDropdown.TextSize = 14
TargetDropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
TargetDropdown.Font = Enum.Font.GothamBold
TargetDropdown.Parent = TargetContainer

local DropdownList = Instance.new("Frame")
DropdownList.Name = "DropdownList"
DropdownList.Size = UDim2.new(1, 0, 0, 100)
DropdownList.Position = UDim2.new(0, 0, 1, 0)
DropdownList.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
DropdownList.BorderSizePixel = 0
DropdownList.ClipsDescendants = true
DropdownList.Visible = false
DropdownList.ZIndex = 50
DropdownList.Parent = TargetDropdown

local targetParts = {"Head", "Torso", "HumanoidRootPart", "LeftLeg", "RightLeg"}
for index, partName in ipairs(targetParts) do
    local PartButton = Instance.new("TextButton")
    PartButton.Name = partName
    PartButton.Size = UDim2.new(1, 0, 0, 20)
    PartButton.Position = UDim2.new(0, 0, 0, (index - 1) * 20)
    PartButton.BackgroundTransparency = 1
    PartButton.Text = partName
    PartButton.TextSize = 14
    PartButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    PartButton.Font = Enum.Font.Gotham
    PartButton.ZIndex = 51
    PartButton.Parent = DropdownList
    
    PartButton.MouseButton1Click:Connect(function()
        Settings.TargetPart = partName
        TargetDropdown.Text = partName
        DropdownList.Visible = false
    end)
end

ToggleButton.MouseEnter:Connect(function()
    TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 40)}):Play()
end)

ToggleButton.MouseLeave:Connect(function()
    TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(20, 20, 20)}):Play()
end)

ToggleButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

CloseButton.MouseButton1Click:Connect(function()
    FOVCircle:Remove()
    ScreenGui:Destroy()
end)

AimbotToggle.MouseButton1Click:Connect(function()
    Settings.Enabled = not Settings.Enabled
    if Settings.Enabled then
        AimbotToggle.Text = "Aimbot: ON"
        AimbotToggle.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        AimbotToggle.Text = "Aimbot: ðŸ—£OFF"
        AimbotToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end
end)

local draggingSlider = false

FOVSlider.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingSlider = true
    end
end)

FOVSlider.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingSlider = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if draggingSlider and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local sliderPos = FOVSlider.AbsolutePosition.X
        local sliderSize = FOVSlider.AbsoluteSize.X
        local mouseX = input.Position.X
        local percent = math.clamp((mouseX - sliderPos) / sliderSize, 0, 1)
        Settings.FOV = math.floor(percent * 200)
        FOVLabel.Text = "FOV: " .. Settings.FOV
        FOVCircle.Radius = Settings.FOV
        SliderFill.Size = UDim2.new(percent, 0, 1, 0)
    end
end)

TeamCheckBtn.MouseButton1Click:Connect(function()
    Settings.TeamCheck = not Settings.TeamCheck
    if Settings.TeamCheck then
        TeamCheckBtn.Text = "Team Check: ON"
        TeamCheckBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        TeamCheckBtn.Text = "Team Check: OFF"
        TeamCheckBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end
end)

KillCheckBtn.MouseButton1Click:Connect(function()
    Settings.KillCheck = not Settings.KillCheck
    if Settings.KillCheck then
        KillCheckBtn.Text = "Kill Check: ON"
        KillCheckBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        KillCheckBtn.Text = "Kill Check: OFF"
        KillCheckBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end
end)

WallCheckBtn.MouseButton1Click:Connect(function()
    Settings.WallCheck = not Settings.WallCheck
    if Settings.WallCheck then
        WallCheckBtn.Text = "Wall Check: ON"
        WallCheckBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        WallCheckBtn.Text = "Wall Check: OFF"
        WallCheckBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end
end)

TargetDropdown.MouseButton1Click:Connect(function()
    DropdownList.Visible = not DropdownList.Visible
end)

local function isAlive(player)
    local character = player.Character
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return false end
    return true
end

local function isTeammate(player)
    if not Settings.TeamCheck then return false end
    if not LocalPlayer.Team or not player.Team then return false end
    return LocalPlayer.Team == player.Team
end

local function isVisible(targetPart)
    if not Settings.WallCheck then return true end
    local origin = Camera.CFrame.Position
    local direction = (targetPart.Position - origin).Unit * 500
    local rayParams = RaycastParams.new()
    rayParams.FilterType = Enum.RaycastFilterType.Exclude
    rayParams.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    local result = Workspace:Raycast(origin, direction, rayParams)
    if result then
        return result.Instance:IsDescendantOf(targetPart.Parent)
    end
    return true
end

local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = Settings.FOV
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, player in pairs(Players:GetPlayers())
        if player ~= LocalPlayer and isAlive(player) and not isTeammate(player) then
            local character = player.Character
            local targetPart = character:FindFirstChild(Settings.TargetPart) or character:FindFirstChild("HumanoidRootPart")
            if targetPart then
                local screenPos, onScreen = Camera:WorldToScreenPoint(targetPart.Position)
                if onScreen then
                    local targetPos = Vector2.new(screenPos.X, screenPos.Y)
                    local distance = (targetPos - screenCenter).Magnitude
                    
                    if distance < shortestDistance and isVisible(targetPart) then
                        if Settings.KillCheck then
                            local humanoid = character:FindFirstChildOfClass("Humanoid")
                            if humanoid and humanoid.Health > 0 then
                                closestPlayer = player
                                shortestDistance = distance
                            end
                        else
                            closestPlayer = player
                            shortestDistance = distance
                        end
                    end
                end
            end
        end
    end
    
    return closestPlayer
end

RunService.RenderStepped:Connect(function()
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    FOVCircle.Position = screenCenter
    FOVCircle.Radius = Settings.FOV
    
    if Settings.Enabled then
        local target = getClosestPlayer()
        if target and target.Character then
            local targetPart = target.Character:FindFirstChild(Settings.TargetPart) or target.Character:FindFirstChild("HumanoidRootPart")
            if targetPart then
                Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPart.Position)
            end
        end
    end
end)
